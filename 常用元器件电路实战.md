# 常用元器件电路实战

## 前言

本文档主要为常见元器件常用电路的实战教学，目的是为了让读者能够快速学会各种常见元器件的分析与实战运用

作者比较🥦，文档内容涵盖或许不够全面，如有专业性错误还请读者见谅并指出，谢谢🙏

免责声明：内容来源于本人学习总结和各种学习资源，如有侵权可及时联系作者

| version | author |  date  | statement |
| :-----: | :----: | :----: | :-------: |
|  V1.0   | Q.Z.Q  | 2023.6 |     /     |
|         |        |        |           |

------

------

温馨提示:	以下节目可能令人情绪不安，请零基础的同学在有基础的同学陪同下观看

## 电阻

电阻作为电路中最常见的元器件，顾名思义其主要作用就是对电路中电荷起阻碍作用。

其主要表现为：

- 对电路系统限（制电）流
- 通过欧姆定律 $U=IR$ 我们又可以使用电阻实现分压，电压电流的比例缩放
- 对于不同性质的电阻，实现不同的功能（如：温敏电阻实现测温等）

注：本节只研究纯电阻电路，一阶及以上电路在本小节不参与讨论，后续再讨论

### ==重要参数==

1. 精度

一般精度有0.1% 1% 5% 10% 15% 25%等；精度与成本直接挂钩

2. 温度系数

电阻随温度变化的物理量，单位ppm/℃

例：一个100kΩ的电阻温度系数是50ppm/℃，则变化1℃其阻值变化 100k * 50 / 10^6^ = 5Ω

3. 功率

### 实战

#### 限流电阻阻值与封装的选择

我们都知道让一个LED发光只需要让LED正向导通，但我们都知道因为不能使LED实际工作电流大于其最大工作电流，所以不能直接将LED直接裸接到正负极。此时则需要串联一个电阻起到限流的作用。常见的一个LED驱动电路，如图

![](https://pic.imgdb.cn/item/647ae53cf024cca173ca1faa.jpg)

假设：

- LED的导通压降为2V	最大工作电流10mA	
- V~CC~ 为5V
- 取LED工作时系统电流 I~set~ 为3mA 	电阻封装采用贴片

> 阻值确定：
>
> 则限流电阻有
>
>  R = V~CC~ - V~LED~ / I~set~ = 3 / 3 = 1kΩ

>封装确定
>
>由《认识元器件》一文我们知道，贴片电阻的封装决定了其最大工作功率
>
>**一般，我们选取封装时，选择实际最大功耗不超过封装最大功耗80%的封装**
>
>由P = I^2^ R = (3mA)^2^ * 1k = 9mW < 1/32*0.8=25
>
>所以选择0402 1k的贴片电阻足够了

至于精度选择的话，市面常见5%精度即可

**【精度越高成本越大，在（系统工作性能、成本等）条件可接受范围内不影响电路系统工作要求下，选择合适精度】**

------

## 电容

### ==重要参数==

1. 精度

2. 温度系数

3. 耐压

电容的电容量会随着两级的电压增大而减少。

**所以在选择电容耐压值的时候最少需要保留80%的裕量【钽电容则需要至少保留50%的裕量】**

4. 温度范围

**电容必须在其规定的温度范围内使用**

5. 等效电阻（ESR）

电容的ESR与工作频率密切相关，在DC-DC电路中电源纹波和电容ESR有关

有些厂商在数据手册上会有ESR-f曲线但有些厂商并没有表明此时我们可以自己去查询-> [ESR查询方法](https://www.bilibili.com/video/BV1wT4y1J7oL/?spm_id_from=333.999.0.0&vd_source=f10f0062b3069d075458559da23d053d)

电容在实际电路的模型如图

<img src="https://pic.imgdb.cn/item/647afd21f024cca173e7e600.jpg" style="zoom:50%;" />

其中各参数分别为

| 参数 |                  说明                  |
| :--- | :------------------------------------: |
| C    |   容值为电容器中的标称值的理想电容器   |
| ESR  |              等效串联电阻              |
| ESL  |      等效串联电感（100pH - 10nH）      |
| Rp   | 并联泄露电阻/绝缘电阻（10MΩ - 100kMΩ） |

ESR：

- MLCC具有最佳的ESR（毫欧级）
- 钽电容的ESR为数百毫欧
- 铝电解电容ESR为欧姆级

### 电容的使用

- <10uF	优先选择陶瓷电
- 10uF - 200uF	可以选择铝电解电容与钽电解电容
- 200uF+	一般选择铝电解电容,钽电容与电解电容的容值较大,但电解电容的耐压值更高

铝电解电容选型

1. 禁止选用贴片的铝电解电容
2. 铝电解电容必须选用工作温度为105度的
3. 对于铝电解电容的容值，优选10   22   47系列，25V以下禁选224   105   475之类容值型号(用片状多层陶瓷电容或钽电解电容替代)
4. 对于高压型铝电解电容保留400V；禁选无极性铝电解电容

钽电容选型

1. 钽电容禁止选用耐压超过35V以上的
2. 插脚式钽电解电容禁选

陶瓷电容选型

1. 高Q陶瓷电容只用在射频电路中
2. 封装0603	0805优选	1206	1210慎选 	1808以上慎选
3. 片状多层陶瓷电容耐压：优选25V	50V	100V	106（含）以上容值的耐压不大于25V
4. 片状多层陶瓷电容的材料：优选NPO   X7R   X5R   其它慎选

### 电容的用途

#### 滤波去耦合

利用电容隔直通交的特性对信号进行选择



从电容的阻抗-频率曲线我们可以看出特定电容在特定频率上有一个最小值点，代表此频率下电容的阻抗最小，则该频率下的信号会优先向该容值电容流过，从而达到信号选择的目的

具体细节可参考视频->[理解电容的阻抗-频率曲线](https://www.bilibili.com/video/BV1vz4y197kP/?p=3&vd_source=f10f0062b3069d075458559da23d053d)

![img](https://inews.gtimg.com/newsapp_bt/0/14211280979/641)

#### 自举（升压）电容

![https://p1-dcd.byteimg.com/img/pgc-image/15311509571828627b11d1a~noop.webp](https://p1-dcd.byteimg.com/img/pgc-image/15311509571828627b11d1a~noop.webp)

#### RC延时

利用电容器充电性质可实现信号的延迟

- $$V_T=V_0+(V_1-V_0)(1-e^{-t\over RC})$$

- $$t=RC*ln(|{V_1-V_0\over {V_1-V_T}}|)$$

当V~0~=0（即电容从0开始充电）我们有

- $$V_T=V_1(1-e^{-t\over RC})$$

- $$t=RC*ln(|{V_1\over V_1-V_T}|)$$

其中

- V~0~ 是电容初始电压
- V~1~ 是电容最终电压
- V~T~ 是t时刻电容充/放电的电压
- t 是充电时间

例：

已知TTL信号低于0.8V为低电平，高于2V为高电平，按钮按下后松开信号S1需要多长时间恢复高电平

![](https://pic.imgdb.cn/item/647b4f08f024cca17361a395.jpg)

$$t=RC*ln(|{V_1\over V_1-V_T}|)=-10^3*100*10^{-9}*ln(|{5\over 5-2}|)≈0.52ms$$

注意：由于实际中电容电阻存在精度误差，所以延时时间也存在误差

------

## 电感

### ==重要参数==

1. 精度

电感的精度一般不会很高

2. **直流电阻（DCR）**

由绕线圈数和线直径决定；一般绕线越粗，圈数越少，DCR越小

3. 自谐振频率（SRF）

由于电感中的寄生电容，电感和自身的寄生电容有谐振频率，这个频率处电感阻抗最大超过谐振频点阻抗开始下降，呈现容性。

4. 额定电流

   1. **温升电流（Irms）**

      在工作时发热量不损坏电感条件下，最大允许持续流过的电流大小。

   2. **饱和电流（Isat）**

      - 带有磁芯的电感

      当电流增大到定程度时，磁场强度不再增加，继续增大电流则元件的电感量将迅速下降。**【不能使电流峰值超过饱和电流】**

      - 不带磁芯的空心电感

      不存在饱和电流，其磁场随电流增大而增大，电感量不变。

## 电感的使用

- 电感必须工作在额定工作温度环境下
- 电感实际工作电流建议最大不超过额定工作电流的 80%

## 电感的用途

### DC-DC电路

Buck降压电路

![点击查看图片来源](https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fmianbaoban-assets.oss-cn-shenzhen.aliyuncs.com%2F2020%2F6%2FvURzma.png&refer=http%3A%2F%2Fmianbaoban-assets.oss-cn-shenzhen.aliyuncs.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=auto?sec=1662050401&t=d5b6a7877ecc85a6534151a0c455a656)

Boost升压电路

![点击查看图片来源](https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fmianbaoban-assets.oss-cn-shenzhen.aliyuncs.com%2F2020%2F6%2FyYZNRz.png&refer=http%3A%2F%2Fmianbaoban-assets.oss-cn-shenzhen.aliyuncs.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=auto?sec=1662050464&t=9aa6532ba9b0ada7266718a458047caf)

### LC滤波电路

>低通滤波电路
>
>高通滤波电路
>
>带通滤波电路
>
>具体可参考->[LC滤波器的基础知识](https://blog.csdn.net/qq_37120496/article/details/123807170)

### LC谐振电路

已知自谐振频率 $f={1\over(2Π\sqrt{LC})}$

通过LC配合可产生特定频率的谐振电路

具体可参考->[LC谐振电路](https://blog.csdn.net/qq_45956802/article/details/120535164?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522163591465116780262519937%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fblog.%2522%257D&request_id=163591465116780262519937&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~blog~first_rank_v2~rank_v29-9-120535164.pc_v2_rank_blog_default&utm_term=LC%E8%B0%90%E6%8C%AF%E7%94%B5%E8%B7%AF&spm=1018.2226.3001.4450)

------

## 磁珠

### ==重要参数==

1. 标称阻抗

阻抗-频率曲线，标称值为100MHz处，选型需要看曲线，关注Z值

2. DCR

DCR会导致电源线上的压降比如3.3V电源如果电流1A，DCR超过0.3Ω时，压降会超过0.3V，导致电压低于3V，导致IC工作异常

3. 最大工作电流

流过磁珠的最大电流不能超过最大工作电流，防止过热烧毁**【一般保留80%裕度】**

### 磁珠的应用

#### 滤（高频）波电路

![](https://pic.imgdb.cn/item/647c77331ddac507cc1443e0.jpg)

- 电源线

选择阻抗-频率特性曲线呈**“矮胖型”**的，保证各个频率都可以过滤

- 数据线

选择阻抗-频率特性曲线呈**“高瘦型”**的，保证有效频率保留，高频噪声过滤

<img src="https://pic.imgdb.cn/item/647c7aa31ddac507cc1d6a21.jpg" style="zoom:50%;" />

辐射整改

1. 确认是否此处辐射:将磁珠改为0Q电阻，确认辐射值是否有变化，有变化说明是此处
2. 满足额定电流和DCR的情况下，尽量选用在超标频率阻抗值大的磁珠，需要考虑偏置电流的影响，需要多尝试

------

## 二极管

二极管种类较多，本节篇幅较长，读者可选择实际需要用到的二极管经行查阅

### ==重要参数==

**总结一句话：关注正向极限参数和反向极限参数**

#### 整流/开关 二极管

1. 最大整流电流/漏电流 I~F~

二极管长时间工作时，允许流过二极管的**最大正向平均电流**，由PN结的结面积和散热条件决定

2. 最大反向工作电压 V~R(WM)~

二极管加反向电压时为防止击穿所取的安全电压，一般将反向击穿电压U~BR~的一半定为最大反向工作电压U~R~

3. 最大反向电流 I~R~

l~R~是指二极管加上最大反向工作电压V~R~时的反向电流。l~R~愈小，二极管的单向导电性就愈好（由于反向电流是由少数载流子形成的，所温度对l~R~的 影响很大）

4. 最高工作频率 f~M~

二极管实际等效电路如下

<img src="https://pic.imgdb.cn/item/647d43f61ddac507cc2d8512.jpg" style="zoom: 50%;" />

f~M~主要由PN结电容 C~T~ 的大小决定，结电容愈大，则f~M~就越低。若工作频率超过f~M~，则二极管的单向导电性就变差，甚至无法使用

5. 反向恢复时间 T~rr~

实际应用中的二极管，在电压突然反向时，二极管电流并不是很快减小到0，而是会有比较大的反向电流存在，这个反向电流降低到最大值的0.1倍所需的时间，就是反向恢复时间

**对于PN结二极管而言，其结电容一般很小（几十pF），所以最高工作频率 f~M~ 由 T~rr~ 决定**

#### 稳压管

1. 稳压值 V~Z~

稳压管正常工作时(**反向击穿状态**)两端电压

2. 稳定电流 I~Z~

使稳压管正常工作时的最小电流**【I<I~Z~ 时稳压效果较差】**

3. 额定功耗 P~Z~

稳压管允许的最大平均功率，有的厂商给的是最大稳定电流I~ZM~；则额定功耗 $P_Z=I_{ZM}U_Z$

4. 动态电阻 r~Z~

指稳压管两端电压与电流的变化量之比 $r_Z={\triangle U_Z\over \triangle I_Z}$

5. 电压温度系数 α~u~

稳压管的温度变化,它的稳定电压也会发生微小变化

定义式：$\alpha_u={\triangle U\over \triangle T}*100\%$

#### 瞬态电压抑制二极管（TVS）

 I~F~	V~R(WM)~	 I~R~

钳位电压 V~C~

#### 肖特基二极管

I~F~	 V~Z~	P~Z~	V~R(WM)~

**（对于肖特基二极管而言，其反向恢复时间一般很小，所以其最高工作频率 f~M~ 由结电容 C~T~ 决定）**

### 二极管的应用



#### TVS

防雷、防浪涌

![](https://pic.imgdb.cn/item/647d50b41ddac507cc3d1098.jpg)

#### 肖特基二极管

续流

![](https://pic.imgdb.cn/item/647d4ea11ddac507cc3a773d.jpg)

#### 整流二极管

本小节在《模电》书中有详细介绍，具体细节读者可翻书查找

单相半波整流

![](https://pic.imgdb.cn/item/647d4d2f1ddac507cc38f8c2.jpg)

单相桥式整流/全波整流

![](https://pic.imgdb.cn/item/647d4dad1ddac507cc397fac.jpg)

防反接

<img src="https://pic.imgdb.cn/item/647d4e2f1ddac507cc3a04c4.jpg" style="zoom: 50%;" />

#### 稳压管

稳压

<img src="https://pic.imgdb.cn/item/647d51741ddac507cc3e30f6.jpg" style="zoom:80%;" />

------

## 三极管

### ==重要参数==

1. 集电极最大电流 I~cm~

为此规定三级电流放大系数β变化不超过允许值时的集电极最大电流称为 I~cm~

tips：三极管没有最大基极电流（本文记为I~bm~）指标,因此datasheet中查不到它，我们只能通过 I~cm~ 和放大倍数来粗略计算

例：8050最大集电极电流1000mA,最小放大倍数85来计算,基极电流正常工作电流应该在11mA达临界饱和,按照2倍余量计算,这种状态下应该使用22mA驱动电流,因此20mA不会损坏该三极管

2. 集电极-发射级反向饱和电流 I~CEO~

I~b~ = 0时，集电极—发射极之间在规定反向电压时的集电极电流。**要求I~CEO~越小越好**

3. 集电极—基极反向截止电流 I~CBO~

I~c~ = 0时，基极和集电极间加规定反向电压时的集电极电流。I~CBO~越小，说明三极管的集电结质量越好

4. 集电极-发射极反向击穿电压 BV~CEO~

如果在使用中加载集电极与发射极之间的电压超过这个数值时，将可能使三极管产生很大的集电电流，这种现象叫击穿。三极管击穿后会造成永久性损坏或性能下降

5. 集电极最大允许耗散功率 P~CM~

耗散功率过大，三极管将烧坏。在使用中如果**三极管在大于P~CM~下长时间工作，将会损坏三极管**

6. 特征频率 f~T~

随着工作频率的升高，三极管的放大能力将会下降，对应$β = 1$时的频率 f~T~ 叫作三极管的特征频率

7. 电流放大倍数

- 直流电流放大系数 	$\overline{\text{a}}$	$\overline{\text{β}}$
- 交流电流放大系数	$\text{a}$	$\text{β}$

### 三级管的使用

三极管一般就两个作用：**放大和开关（含反向和滤波）**

#### 三极管基本放大电路

##### 无偏置放大电路

![image-20230524193638203](https://pic1.imgdb.cn/item/646e151a0d2dde5777549211.png)

优点：结构简单

缺点：稳定性不足

应用分析

==静态工作点确定==

> 确定 V~ce~ 、 I~b~ 和  I~c~ 
>
> 一般来说，V~CC~ 已经由用户设计的电路系统确定了。为保证三极管工作在放大区且输入信号不失真只需满足
> $$
> 0.3V<V_{ce}<{V_{CC}\over 2}
> $$
>
> 一般我们取 V~ce~ = (V~CC~ - 0.3) / 2
>
> 根据**==放大特性曲线图==**确定 I~b~ 进而计算出 I~c~ 从而确定出 R~b~ 、R~c~

##### 有偏置放大电路

优点：稳定性好、放大倍数容易控制（A~u~ ≈ R~c~/R~e~）

缺点：电路较为复杂，成本增加

![image-20230524193536642](https://pic1.imgdb.cn/item/646e151e0d2dde57775496d5.png)

###### 应用分析

==静态工作点确定==

![image-20230524214801543](https://pic1.imgdb.cn/item/646e15950d2dde5777553123.png)

> 确定 V~b~ (人为设定2~3V)【不能太小（Au很小），不能太大（共功率太大）】
>
> 确定 V~ce~ 、 I~b~ 和  I~c~ （方法如上）
>
> ==注意：此时 V~ce~ 取值有变化，V~ce~  = (V~CC~ - V~e~ - 0.3)/2==
>
> V~e~ = V~b~ - V~th~	根据 I~c~ 算出R~e~
>
> V~ce~ = V~CC~ - I~c~ R~c~ 	得出 R~c~
>
> 偏置网络电流 I 取 I~b~ 10倍左右	上述两点即可得出偏置电阻R1 R2阻值

注：实测电路各参数与理论计算有所偏差（比较小，在误差允许范围内）

#### 三极管饱和应用电路

##### 反相器

下图是三极管电路作为反相器应用的常见电路

![image-20230525155330458](https://pic1.imgdb.cn/item/646f13fcf024cca173625df8.png)

其中2.0相比于1.0在实际中应用得更多，因为相比而言2.0的效率会更高，但随之牺牲的就是电路的占用面积与成本

###### 应用分析

假设：

- LED（负载）工作电压2V，工作电流5mA
- 三极管开启压降0.7V，基极工作电流取1mA
- V~CC~ 为5V直流，控制信号高电平为5V低电平为0V

（注：仿真软件中LED导通压降不可设置，通常数据手册中会标明LED导通压降，此部分内容只为教学，假设参数只用于分析，实际设计时需要参考实际数据和实际情况）

###### 基极限流电阻 R~b~ 的计算

> 三极管开启时，V~b~ = V~control~ - V~th~ = 5 - 0.7 = 4.3V
>
> R~b~ = V~b~ / I~b~ = 4.3 / 1 = 4.3 kΩ	取4.7 kΩ	或	3.9 kΩ

###### 负载电阻R/R~1~ 的计算

>R = V~CC~ - V~LED~ / I~LED~ = (5 - 2) / 0.005 = 600 Ω	取 500Ω
>
>R~1~ = V~CC~ - V~LED~ - V~ce~ / I~LED~ = (5-2-0.3) / 0.005 = 560 Ω	取 500Ω

###### 基极限流电阻 R~2~ 的计算

>R~2~ = V~CC~ / I~b~ = 5 / 1 = 5 kΩ	取 5.1 kΩ

###### 仿真分析

开关闭合（相当于控制信号为高电平），三极管开启，负载输出（约等于）0 ；

对于反相器1.0来说

> 此时系统的无功功率为
>
> 基极电阻R~b~ 上的热耗功率P~b~ + 负载限流电阻R上的热耗功率P 
>
> = I~b~^2^ * R~b~ + I~R~^2^ R ≈ 51.4 mW

对于反相器2.0来说

>此时系统的无功功率为
>
>基极电阻R~b~ 上的热耗功率P~b~ + 负载限流电阻R~1~上的热耗功率P~1~      + 基极电阻R~2~ 上的热耗功率P~2~
>
>= I~b~^2^ * R~b~ + I~1~^2^ R~1~ + I~b~^2^ * R~2~ ≈ 8.3 mW



<img src="https://pic1.imgdb.cn/item/646f1428f024cca173629ee2.png" alt="image-20230525155411673"  />

开关打开（相当于控制信号为低电平），三极管关闭，负载正常输出；

对于反相器1.0来说

> 此时系统的无功功率为
>
> 负载限流电阻R上的热耗功率P 
>
> = I~R~^2^ R ≈ 20.9 mW

对于反相器2.0来说

>此时系统的无功功率为
>
>基极电阻R~b~ 上的热耗功率P~b~ + 负载限流电阻R~1~上的热耗功率P~1~      + 基极电阻R~2~ 上的热耗功率P~2~
>
>= I~1~^2^ R~1~ + I~b~^2^ * R~2~ ≈ 22.8 mW

![image-20230525155505631](D:\File\学习文档\photo\image-20230525155505631.png)

所以在板面积与成本预算充足或对功耗要求较高条件时：优先使用反向器2.0

##### 线性稳压器

下图是主要由三极管和稳压二极管组成的线性稳压电路

==**注意：此时的三极管必须工作在饱和状态**==

![image-20230525195118741](https://pic1.imgdb.cn/item/646f4bb9f024cca173baa8ad.png)

电路原理：

利用 V~b~ - V~e~ = V~th~ 只需要确定 V~th~ 与 V~CC2~ 选取合适的稳压二极管即可获得稳定的输出电压 V~CC2~ 

电容的作用：使输出跟平滑

###### 应用分析

假设：

- V~CC1~ = 12 V	V~CC2~ = 6 V	V~th~ = 0.8 V
- LED（负载）工作电压2V、工作电流5mA	稳压二极管稳压 6.8V
- I~b~ 取 5 mA

###### 基极限流电阻计算

> R~2~ = V~CC1~ -V~D~ / I~b~ = (12 - 6.8) / 5 = 10.4 kΩ	取10 kΩ

###### 集电极限流电阻计算

> R~1~ = V~CC1~ - V~ce~  / I~LED~ = V~CC1~ - V~c~ - V~e~  / I~LED~ = (12 - 0.3 - 6) / 5 = 11.4 kΩ	取10 kΩ

###### 负载电阻R/R~1~ 的计算

>R = V~CC2~ - V~LED~ / I~LED~ = (6 - 2) / 0.005 = 800 Ω	

###### 仿真

![image-20230525212745092](https://pic1.imgdb.cn/item/646f6254f024cca173de4cc6.png)

------

## MOS管

### ==重要参数==

1. 开启电压 V~gsth~

MOS导通的条件

2. 最大漏-源电压 V~dss~

指漏-源未发生雪崩击穿前所能施加的最大电压（根据温度的不同，实际雪崩击穿电压可能低于额定VDSS）

3. 最大栅源电压 V~gs~

栅源两极间可以施加的最大电压。设定该额定电压的主要目的是防止电压过高导致的栅氧化层损伤

4. 连续漏电流 I~D~

定义为芯片在最大额定结温TJ(max)下，管表面温度在25°C或者更高温度下，可允许的最大连续直流电流

5. 导通电阻 R~DS~

指在特定的漏电流 (通常为ID电流的一半)、栅源电压和25°C的情况下测得的漏-源电阻，随着条件（V~gs~ 、温度、I~D~）改变，R~DS~ 也会有所变化，具体参考厂商的datasheet

6. 最大耗散功率 P~DSM~ 

MOS管实际功耗应小于 P~DSM~ 并留有一定余量（一般保留80%裕度）

7. 反向恢复时间 t~rr~

一般与工作频率挂钩，需要保证

$最大工作频率f_{SW} < {1\over3}{1\over t_{rr}}$

### MOS管的使用

#### MOS管的米勒效应

由于MOS管结构的原因，每两级之间会存在寄生电容，如图

<img src="https://pic.imgdb.cn/item/647ee6c71ddac507cc9a80a1.jpg" style="zoom:80%;" />

由于这些寄生电容（主要是 C~gd~ 也称之为米勒电容）的存在，导致MOS在开启的时候需要给电容充电从而，导致开启时间延长并增加了功耗（关断时同理）

厂商在芯片手册通常给的参数不是直接给出这三个寄生电容的参数，而具体关系如下表

| **C~iss~** | **=** | **C~gs~ + C~gd~** |
| :--------: | :---: | :---------------: |
| **C~rss~** | **=** |     **C~gd~**     |
| **C~oss~** | **=** | **C~gd~ + C~ds~** |

具体可参考[详解米勒效应](https://www.elecfans.com/d/1306891.html)

**缓解方法：**

- 选择米勒电容Crss较小的MOS管
- 增大驱动电流
- 提高驱动电压

#### MOS的振铃现象

又由于这些寄生电容的存在，又由于导线上的寄生电感，当信号到达MOS管的栅极时，产生的LC谐振现象我们称之为振铃。振铃信号一般频率较高，会对周围的器件产生EMI干扰，影响其他器件的正常工作，甚至烧毁器件

<img src="https://pic.imgdb.cn/item/647f26c61ddac507cc08ffb1.jpg" style="zoom: 80%;" />

**缓解方法：**

1. 驱动路径拉短，最容易忽略的就是地，MOS靠近MCU

2. 在GS端并TVS，把电压限定在安全范围内

3. 栅极串联个小电阻（阻值合适），在LC震荡串联R可以形成阻尼消耗能量，减小震荡。电阻不宜太大，会使MOS上升下降沿变得缓慢。会导致mos发热

4. 在R上并联二极管接地，让下降沿更陡峭

<img src="https://pic.imgdb.cn/item/647f409b1ddac507cc3f96b6.jpg" style="zoom:80%;" />

### MOS开关电路

#### NMOS高侧开关	PMOS低侧开关

常见的最简单的MOS开关电路（若想提高MOS开关性能可参考上小节“MOS管的使用”中的MOS管米勒效应以及振铃现象的缓解措施）如下

![](https://pic.imgdb.cn/item/647fdf6c1ddac507cc33e6f0.jpg)

根据MOS管的导通条件，我们一般把NMOS作高侧开关，PMOS作低侧开关；当然，反过来也是可以的，只是我们需要根据MOS管的导通条件，添加合适的自举电路（为了方便一般添加一个自举电容即可），否则MOS管的工作状态将达不到预期（具体分析在此不多赘述，有兴趣的读者可以自行查阅资料）

回到电路分析

- R~g~ 是栅极阻尼电阻【一般不会太大】，具体作用参考上小节
- R~s~ 是上/下拉电阻【一般在1k-10k的范围】，因为大部分情况，MOS管的控制信号（图中的control）大多为单片机MCU的IO口提供；在上电前通常为高阻态（不确定也不稳定）的状态，为了避免这种不确定的状态，我们借助上/下拉电阻给MOS栅极一个确定的（关闭）状态

#### 电子开关改良1.0：三极管+MOS

上小节提到：MOS管的控制信号大多为单片机MCU的IO口提供的，但一般而言，这个IO口的驱动能力是有限的，电流很小，一般在10-20mA以内，所以一般很少用单片机直接驱动负载这种方式；而提到电流驱动，我们立马就能想到三极管，所以，一般选择I/O口直接控制三极管，然后再控制MOS管

NMOS型

![](https://pic.imgdb.cn/item/648025351ddac507cc9aef65.jpg)

**分析：**

电路原理：

当三极管关闭状态时，NMOS栅极通过 R~1~、R~2~ 分压导通，输出OUT ≈ V~CC~；当三极管导通状态时，NMOS栅极被三极管拉低截止

- R~b~ 三极管基极电阻，限流作用，由$I_b={V_{control}-V_{be}\over R_b}<0.8*I_{bm}$计算 R~b~ 的值
- R~bs~ 下拉电阻，主要作用是在系统未上电时，保证三极管关断状态，也有限流保护作用，通常 R~bs~ >> R~b~ （取5-10倍即可）保证控制信号为高电平时三极管正常开启
- R~1~、R~2~ 分压限流电阻，需要保证
  - $V_{CC}{R_1\over R_2}>V_{gsth}$
  - ${V_{CC}\over R_1+R_2}<0.8*电极极限电流$
  - ${V_{CC}-V_{ce}\over R_1}<0.8*I_{cm}（最大集电极电流）$

PMOS型

![](https://pic.imgdb.cn/item/64803bbc1ddac507ccc00aaa.jpg)

**分析：**

电路原理：

当三极管关断状态时，由于 $V_{gs}≈0>V_{gsth}$ 	PMOS关闭，OUT = 0

当三极管导通状态时，由于 $V_{gs}≈-V_{CC}<V_{gsth}$ PMOS开启，OUT ≈ V~CC~

- R~b~ 三极管基极电阻，限流作用，由$I_b={V_{control}-V_{be}\over R_b}<0.8*I_{bm}$计算 R~b~ 的值
- R~bs~ 下拉电阻，主要作用是在系统未上电时，保证三极管关断状态，也有限流保护作用，通常 R~bs~ >> R~b~ （取5-10倍即可）保证控制信号为高电平时三极管正常开启
- R 限流电阻，需要保证
  - ${V_{CC}\over R}<0.8*电极极限电流$
  - ${V_{CC}-V_{ce}\over R}<0.8*I_{cm}（最大集电极电流）$

#### 电子开关改良2.0：三极管+背靠背PMOS

**分析：**

电路原理：

由于 Q~1~ 体二极管的存在，S点的电压始终 ≈ V~CC~ 

当三极管关断状态时， $V_{gs1}≈V_{gs2}≈0>V_{gsth}$ ，Q~1~ Q~2~ 关闭，OUT ≈ V~CC~

当三极管导通状态时， $V_{gs1}≈V_{gs2}≈-V_{CC}>V_{gsth}$， Q~1~ Q~2~ 关闭，OUT = 0

- R~b~  三极管基极电阻，限流作用，由$I_b={V_{control}-V_{be}\over R_b}<0.8*I_{bm}$计算 R~b~ 的值
- R~bs~  下拉电阻，主要作用是在系统未上电时，保证三极管关断状态，也有限流保护作用，通常 R~bs~ >> R~b~ （取5-10倍即可）保证控制信号为高电平时三极管正常开启
- R 限流电阻【通常取值100k左右】需保证
  - ${V_{CC}\over R}<0.8*电极极限电流$
  - ${V_{CC}-V_{ce}\over R}<0.8*I_{cm}（最大集电极电流）$

**两个MOS管的存在相比于一个MOS起到了防倒灌的作用，等效于一个开关二极管**

![](https://pic.imgdb.cn/item/648068371ddac507cc0ac6e9.jpg)

------

## 晶振电路设计

### ==重要参数==

1. 标称频率 f

2. 负载电容 C~L~

指连接到晶振上的终端电容 （值由厂商给出）。C~L~ 值取决于外部电容器C~L1~ 和C~L2~ ，杂散电容C~S~

如下计算式
$$
C_L={C_{L1}*C_{L2}\over C_{L1}+C_{L2}}+C_S
\\
C_S=C_0+C_{PCB}+C_{pin}
$$
其中

- C~S~ 为杂散电容，即晶振所有寄生电容的等效模型
- C~0~ 为晶振的静电容（Shunt capacitance）从datasheet中查询
- C~PCB~ 为PCB走线带来的寄生电容
- C~pin~ 为芯片管脚带来的寄生电容

3. 激励功率DL

驱动功率描述了晶振的功耗。晶振的功耗必须受到限制，否则石英晶体可能会由于过度的机械振动而导致不能正常工作。通常由厂商给出晶振驱动功率的最大值，单位通常是毫瓦。超过这个值时，晶振可能就会损坏

计算式如下
$$
DL=ESR*I_Q^2
$$
其中

- ESR 指晶振的等效串联电阻（一般厂商datasheet中会给出）
- I~Q~ 是流过晶振电流的有效值，使用示波器可观测到其波形为正弦波

当I~Q~ 超过I~QmaxPP~ 时，R~ext~ 是必需的，并且R~ext~ 要加入到ESR中去参与计算I~Qmax~

### 外围电路设计

- 确定外部负载电容 C~L1~ C~L2~

上小节我们知道

$C_L={C_{L1}*C_{L2}\over C_{L1}+C_{L2}}+C_0+C_{PCB}+C_{pin}$

一般我们会设置C~L1~ = C~L2~

所以$C_{L1}=C_{L2}={2\{C_{L}-(C_0+C_{PCB}+C_{pin})}\}$

实际中 C~L1~ C~L2~ 的值不一定严格按照理论计算值确定，相近的值对于整个电路系统影响不大

（注：关于PCB走线的寄生电容值的计算与确定我将会在《PCB设计时的经验公式》中提及，有兴趣的读者可以前往阅读学习）

- 确定外部串阻 R~ext~

如果晶振的功耗超过晶振制造商的给定值，外部电阻Rext是必需的，用以避免晶振被过分驱动。如果晶振的功耗小于晶振制造商的给定值，就不推荐使用R~ext~ 了，它的值可以是0Ω

对于R~ext~ 预估值可以通过考虑R~ext~ 和C~L2~ 构成的滤波器确定；通带宽度应不小于振荡器频率，当振荡频率正好等于滤波器截止频率时

计算式有
$$
R_{ext}={1\over2\pi fC_{L2}}
$$

- 增益裕量

 增益裕量计算式为
$$
gain_{margin}={g_m\over g_{mcrit}}
$$
**为保证可靠的起振，要求gain~margin~ > 5**

其中

- gm是反相器的跨导（高频时单位是mA/V，低频时是μA/V，比如32Khz）
- gmcrit (gm critical)的值取决于晶体参数

在$C_{L1}=C_{L2}$ 且电路实际的C~L~ 与制造商给定的C~L~ 值相同 gmcrit 计算式如下
$$
g_{mcrit}=4*ESR*(2\pi f)^2*(C_0+C_L)^2
$$
如果不能满足增益裕量起振条件(即增益裕量		gain~margin~ 小于5)，晶振无法正常起振，应尝试选择一种ESR较低，C~L~较低的晶振

### *电路评估

在电路设计完成进入测试阶段，若发现实际产品的效果并没有达到预期设想的设计效果，常见的问题有：1. 晶振电路停振 2. 频偏过大

那么我们将要对电路进行评估与改良

#### 评估项目

##### 振荡频率 频率相对偏差

定义：谐振器被实装在电路中工作时的频率

一般使用频谱仪或频率计数器而不用精度较低的示波器直接测量

具体内容可参考[振荡频率测量]([晶体谐振器的电路测试讲座 | 晶体谐振器 | 村田制作所 (murata.com)](https://www.murata.com/zh-cn/products/timingdevice/crystalu/overview/basic))

##### 振荡余量

定义：从振荡到停止的余量，用谐振器共
振相对规格值的倍数来表示

计算式
$$
振荡余量={负阻\over 晶振等效串联电阻}={|-R|\over ESR_{spec}}
$$
PS：

1. 为了稳定起振，一般要求振荡余量>5
2. 负阻的大小需要在实际电路中测量
3. ESR~spec~ 一般厂商datasheet中会给出

负阻的测量：

过程比较复杂，具体我就不用文字介绍了，详细可以看 [**振荡余量测量**]([晶体谐振器的电路测试讲座 | 晶体谐振器 | 村田制作所 (murata.com)](https://www.murata.com/zh-cn/products/timingdevice/crystalu/overview/basic))

##### 激励功率

定义：谐振器的功耗（一般厂商在datasheet中会给出）

如果激励功率超出了谐振器的规格，则有可能发生振荡频率和等效电阻的变动等电路不稳定情况出现

激励功率的测量：

通过$P=I^2*RSR$ 可知，我们（使用示波器、万用表或频谱仪等仪器）测出电流即可算出激励功率，具体操作可参考[**激励功率的测量**]([晶体谐振器的电路测试讲座 | 晶体谐振器 | 村田制作所 (murata.com)](https://www.murata.com/zh-cn/products/timingdevice/crystalu/overview/basic))

------

## 运算放大器

### ==重要参数==

1. **最大供电范围（Supply Voltage）**

2. 输入偏置电流 I~B~

理想运算放大器虚断，流入反向输入端与同向输入端的电流本应该为零。但是实际的运算放大器流入反向输入端与同向输入端的电流不为零，输入偏置电流 $I_B={I_{OS}\over2}={(I_{b+}+I_{b-})\over2}$ 

其中 $I_{OS}=I_{b+}+I_{b-}$ 定义为两个电流差，此**参数越小越好**

3. 噪声 V~n~

单位：$nV/\sqrt{Hz}~@1kHz$  大部分运放的噪声主要是白噪声和1/f噪声两部分，其中白噪声与频率无关，1/f噪声则与频率有关，所以才有@1kHz这种说法

4. 静态电流 I~Q~

运放在没有负载情况下的待机电流或者建立静态工作点的电流，越小越好；要求低功耗的场合要特别关注此指标

5. 输入失调电压 V~OS~ 

由“虚断”知同相端和反相端电压相等，但是由于同相端和反相端失配而产生了固有电压差，就叫输入失调电压，一般V~OS~约为 (1~10) mV，高质量运放V~OS~在1mV以下

6. 输入失调电压温/时漂 dV~OS~/dT

指输入失调电压 V~OS~ 随工作时间和温度的改变而产生的漂移量

7. **增益带宽积 GBW/GBP**

定义：当运算放大器在小信号 ( V~pp~在1V以下的信号)环境下应用时，电压反馈运算放大器的带宽和增益的乘积是一个定值，称为增益带宽积

要求 $GBW≥(10\sim100)*gain*f$

其中

- gain为放大倍数	
- f为单位为1MHz的频率

8. **电压转换速率/压摆率 SR**

其定义是在1us 或者1ns 等时间里电压升高的幅度，直观上讲就是方波电压由波谷升到波峰所需时间，单位通常有V/s，V/ms，V/us和V/ns四种

要求 $SR≥2\pi f*V_{om}$

其中

- V~om~ 为输出电压幅值（单位V
- f为单位为1MHz的频率

9. 输入电压范围+输出电压范围（input/output swing）

在最大输出幅度和供电电源轨间必须有一定的裕量或净空，保证输出不被削顶/底（信号失真）。对输入也是一样。
根据运放输出结构不同，这个裕量从数mV到数V不等

10. 短路电流 I~SC~

标明运放输出级输入或者灌入电流的能；表征输出的驱动能力

![](https://pic.imgdb.cn/item/64871e311ddac507cc4f98ac.jpg)

11. 运放的输入阻抗

选择运放输入阻抗时要考虑到被放大对象 (信源) 的内阻。运放的输入阻抗要远远大于信源内阻。例如信源内阻为10KQ，则需要选择100K以上的输入阻抗才能达到90%的精度，要达到99%的精度则要选择1M以上的输入阻抗（**此参数越大越好**）

###  运放的使用

#### **供电方式**

**运放供电分为单电源供电和双电源供电两种**，但是运放工作时是分不清你是给它单电源供电还是双电源供电的，只要产生足够的压差，运放就能工作

而单电源供电方式一般工作于**处理直流、处理低频交流（音频，超声波信号）**

- **单电源供电的优点：节约成本**
- **单电源供电的缺点：输出小信号的时候误差较大，输出电压越小误差越大、处理频率低【≤ 100kHz】**

#### **消除输入失调电压 V~OS~**

1. （具有零位调整的运放）根据芯片手册调节
2. 在放大器输入端加一偏置电路
3. 单电源供电的放大电路，主要加一完全对称的放大电路，并且把其中一路接地（尽量选用同一芯片内的运放，以便消除温漂的影响）

#### **GBW和SR选择太小会造成输出电压失真**

最明显的例子就是输入标准正弦信号，结果输出成了三角波

修正措施

1. 换用GBW和SR更大的运放
2. 采用多级放大，例：放大100倍可经过（第一级）放大10倍，（第二级）再放大10倍
3. 采用电流负反馈结构（但需要注意，选用此结构时易产生振荡噪声，需严格遵循datasheet电路推荐设计）

#### **运放的噪声的计算**

温馨提示：学习前若读者不清楚带宽噪声如何计算的可以参考文章[运算放大器的噪声计算](https://blog.csdn.net/sinat_15677011/article/details/106268473)具体可查阅书籍《你好，放大器》P29-P50【文章就是书上扒下来的😅】；网上文章有不一样的说法，（TI公司出的运放学习资料中[运算放大器系列--噪声](https://www.bilibili.com/video/BV14t4y127x4?p=1&vd_source=f10f0062b3069d075458559da23d053d)就有不同的说法，计算起来有丝毫偏差）孰对孰错作者暂时未深入研究，本文书本《你好，放大器》为参考，有兴趣研究的读者可在得出结论后补充

实际电路中，运放组成的放大电路输出噪声计算十分复杂，产生源很多，本小节先介绍最重要的一个，等效输入电压噪声的计算

![](https://pic.imgdb.cn/item/64892df51ddac507cc5fe574.jpg)

运放常见的噪声源有两类，一类为白噪声/平坦噪声（其电能力是一条直线，与频率无关），另一类为1/f噪声（其电能力密度随着频率上升而下降）

以TI通用运放LM2904为例（其他运放datasheet可能没有LM2904写的详细，但是思路类似）设计最简单的同向比例放大电路，放大倍数为2，如图

<img src="https://pic.imgdb.cn/item/6489729d1ddac507cc332e1e.jpg" style="zoom:50%;" />

##### 运放的白噪声

（一定频率范围内）计算公式
$$
噪声能量：
E_{N\_wh}=\int_{f_a}^{f_b}D_{E\_wh}(f)df=K^2*(f_b-f_a)
\\噪声电压有效值：
U_{N\_1f}=\sqrt{D_{E\_wh}(f)}=K\sqrt{(f_b-f_a)}
$$


其中

- K 为白噪声的噪声电压密度
- f~a~ 为起点频率
- f~b~ 为截止频率

###### K 值确定

方法一（常用且较为准确）：datasheet中可知LM2904输入电压噪声密度e~n~ 即为K值

![](https://pic.imgdb.cn/item/648829761ddac507ccf7462c.jpg)

方法二（粗略）：读图法，噪声电压密度-频率曲线图中找到最高频率点，直接读值

###### 截止频率 f~a~ 确定

理论上噪声是广谱信号，最低频率 f~a~ 可以达到 0Hz，但是从计算公式出发，f~a~ 不能取0；所以工程上人们认为噪声频率低于0.1Hz 时此噪声是人为、环境因素带来的扰动与系统无关，所以**一般取 f~a~ = 0.1Hz**

###### 截止频率 f~b~ 确定

最高频率点一般对应系统带宽，这里指的是运放电路的带宽，上面电路放大两倍，而通过查询datasheet我们知道LM2904 本身的增益带宽积为0.7MHz

![](https://pic.imgdb.cn/item/64884ab11ddac507cc906d50.jpg)

所以系统带宽为：$0.7/2=0.35MHz$ 这个电路等效为一阶滤波器带宽还需要乘以相关的系数 1.57，因此，最终系统噪声带宽为$BW_n=0.35MHz*1.57=0.55MHz$，一般认为最高频率 f~b~ = BW~n~

$白噪声电压有效值：
U_{N\_1f}=\sqrt{D_{E\_wh}(f)}=K\sqrt{(f_b-f_a)}=40(nV/\sqrt{Hz})*\sqrt{0.55M-0.1~(Hz)}=29664.7nV$

##### 运放的闪烁噪声（1/f 噪声）

计算公式
$$
噪声能量：
E_{N\_1f}=\int_{f_a}^{f_b}D_{E\_1f}(f)df=C^2*ln({f_b\over f_a})*1Hz
\\噪声电压有效值：
U_{N\_1f}=\sqrt{E_{N\_1f}}=C\sqrt{ln({f_b\over f_a})}*\sqrt{1Hz}
$$
其中

- C 为1/f噪声在f=1Hz处的噪声电压密度，单位为V/√Hz

  （一般通过噪声电压密度-频率曲线图获取）

###### C 值确定

（1）曲线覆盖1Hz

如果噪声电压密度-频率曲线中1Hz处的值D~U~（1Hz）可以读到，那么他是1*f 噪声和白噪声的叠加值即
$$
D_U(1Hz)=\sqrt{(~D_{U\_1f}(1Hz)~)^2+(~D_{U\_wn}(1Hz)~)^2}=\sqrt{C^2+K^2}
$$
即可解得
$$
C=\sqrt{(~D_U(1Hz)~)^2-K^2}
$$
（2）曲线不覆盖1Hz

某些运放的datasheet（特别时高速运放）其噪声电压密度-频率曲线不覆盖1Hz（如LM2904），此时我们找出曲线图中最小频率 f~min~ 有
$$
D_U(f_{min})=\sqrt{(~D_{U\_1f}(f_{min})~)^2+(~D_{U\_wn}(f_{min})~)^2}=\sqrt{C^2{1Hz\over f_{min}}+K^2}
$$
即可解得
$$
C=\sqrt{{{f_{min}\over1Hz}}((~D_{U\_1f}(f_{min})~)^2-K^2)}
$$
（3）从转角频率计算

有些datasheet会给出这个参数，定义1/f 噪声和白噪声相等时的频率称为转交频率，记为 f~corner~ 

已知 $D_{U\_1f}(corner)=D_{U\_wn}(corner)=\sqrt{C^2{1Hz\over f_{corner}}}=K$

即
$$
C=K\sqrt{{f_{corner}\over 1Hz}}
$$




由datasheet中我们可以找到，LM2904的噪声电压密度-频率曲线图

![](https://pic.imgdb.cn/item/648819de1ddac507cccf35de.jpg)

根据LM2904的噪声电压密度-频率曲线图，我们有$D_U(f_{min})=D_U(10Hz)=55nV/\sqrt{Hz}$

有
$$
C=\sqrt{{{f_{min}}\over1Hz}((~D_{U\_1f}(f_{min})~)^2-K^2)}=\sqrt{{10(Hz)\over1Hz}(~55^2-40^2(nV/\sqrt{Hz}~)^2)}=119.4nV/\sqrt{Hz}
$$
$1/f噪声电压有效值：U_{N\_1f}=C\sqrt{ln({f_b\over f_a})}*\sqrt{1Hz}=119.4(nV/\sqrt{Hz})\sqrt{ln({0.55M\over 0.1})}*\sqrt{1Hz}=470.4nV$

从计算我们也可以看出$E_{N\_wh}>>E_{N\_1f}$ ，可知**输入噪声的有效值白噪声占主导**

##### 运放的等效输入电压噪声

$$
U_{N\_I}=\sqrt{(E_{N\_wh})^2+(E_{N\_1f})^2}
$$

$U_{N\_I}=\sqrt{(E_{N\_wh})^2+(E_{N\_1f})^2}=\sqrt{29664.7^2+470.4^2}=29668.4nV$

##### 运放的等效输入电流噪声

计算方法类似于运放的总等效输入电压噪声，但一般值比较小；由于LM2904没有相关参数，所以在此不展开计算

##### 电阻的热噪声

电阻的噪声计算较为复杂包含热噪声、接触噪声和散粒噪声等，但**通常指的是热噪声**

电阻热噪声有效值的计算公式有
$$
E_n=\sqrt{4kTRB}
$$
其中

- k 为玻尔兹曼常数，$k=1.38*10^{-23}J/K$
- T 为为开尔文热力学温度
- R 为电阻值
- B 为系统等效噪声带宽

#### **运放电阻的选择**

以最简单的反向放大电路为例，如图，我们知道  $u_{out}=-(u_{in}*A_v)=-{R_1\over R_2}u_i$

<img src="https://pic.imgdb.cn/item/6488085c1ddac507cca07b9f.jpg" style="zoom:80%;" />

要想实现放大倍数为2的电路只需控制R~1~/R~2~=2即可，R~1~和R~2~分别是2K, 1K能达到目的，20K, 10K也能达到目的，200K, 100K也能达到目的，但这些电阻搭配都是可以随便加在电路上就能正常使用的吗？

要想知道答案，我们接着往下看

首先我们要知道电阻对运放的影响主要是如下几个方面

1. 驱动能力和功耗
2. 误差
3. 稳定性

##### 驱动能力与功耗

显然，电阻越小输出电流越大，功耗越高（相比于电阻，电流对于功耗是以平方倍影响的，占主导）

还是以上图举例子，假设电路参数如下

![](https://pic.imgdb.cn/item/64880b3e1ddac507cca82223.jpg)

显然，一般的放大器都不支持1A这么大的驱动能力

还是以TI通用运放LM2904为例

![](https://pic.imgdb.cn/item/648810101ddac507ccb518dd.jpg)

注：

- 吸/拉电流（Source）指运放往外流的电流
- 灌电流（Sink）指运放往内灌入的电流

LM2904运放的最大输出灌电流典型值最小值为5mA，针对上面的电路，显然，输出电压最大时，输出电流最大。如果采用3.3V供电，那么输出电压不会超过3.3V，则最大输出电流I~max~ = 3.3V/R1<5mA计算得R1>660Ω 即反馈电阻R1至少要大于660Ω

**灌电流过大的影响：**

从手册上的输出灌电流特性可以看出，LM2904（非轨对轨运放），在输出灌电流5mA以下时，输出电压只比供电电压少1.2V左右；而当输出灌电流超过10mA时，输出电压相比供电电压的差值急剧增加，**造成的后果可能就是输出摆幅不够**

PS：曲线图是输出灌电流与输出电压相对于供电电压（差）值

![](https://pic.imgdb.cn/item/648813db1ddac507ccbf2f0a.jpg)

##### 噪声影响

根据运放的驱动能力和功耗我们可以得出运放外围电阻的最小值，但是如果反馈电阻过大，输出误差也可能会增大，主要因为

1. 电阻本身存在噪声，阻值越大，噪声越大
2. 电阻越大，增大了偏置电流引起的失调电压

关于第一点，一般有一个原则：**电阻噪声，不能大于运放本身的噪声**

因为运放本身的噪声大小与成本相关，如果花了钱选了一个高精密的运放，结果电阻噪声占主导地位，这显然是不合理的。上小节我们已经学会了计算运放的噪声，所以，我们需要计算电阻的噪声并和运放的噪声经行比较

$E_n=\sqrt{4kTRB}<U_{N\_I}=29668.4nV$

算出R < 97.2KΩ

**【注意这里计算出的R是与例子中R~1~与R~2~并联（我猜是从输入输出端看向运放电路的等效电阻）的阻值相比较】**

##### 偏置电流的影响

我们知道运放的输入阻抗很大，所以才有了“虚断”的概念。其根本原因是因为外部电阻的电流远大于运放输入端的偏置电流，所以我们分析的时候，可以忽略偏置电流，将流入运放输入端的电流看作是0

但是如果不满足I~R~ >> I~b~，运放输入端会分走一部分电流，造成流过 R~1~和 R~2~的电流有差异，放大倍数也不是R~1~ / R~2~

还是以LM2904为例，继续沿用之前说的比例运放电路

通过查询datasheet我们有 I~Bmax~ = 50nA

![](https://pic.imgdb.cn/item/6489c07d1ddac507cc0d42f6.jpg)

这个应该很容易得到：

当l~B~ = 0时，有I~R1~ = I~R2~，V~out~ = l~R1~ * R~1~ = I~R2~ * R~1~，即I~R2~ * R~1~为无误差时的输出电压

当I~B~ 不为0时，有I~R1~ = R~2~ + l~B~ ，V~out~ = l~R1~ * l~B~ = (I~R2~ + l~B~) * R~1~ = I~R2~ * R~1~ + R~1~ * l~B~ ；相对于I~B~ = 0时的输出电压	R~1~ * l~B~ 为多出来的，即为l~B~ 引起的输出电压误差

因此，l~B~ 引起的输出误差电压为：V~out(err)~=R~1~ * l~B~

如果我们想输出误差电压V~out(err)~ < 1mV	则 R~1~ * I~Bmax~ < 1mV	得R1 < 20kΩ

##### 运放的输入偏置电流

详情可以看[视频]([EEVblog #479 - 运放的输入偏置电流_哔哩哔哩_bilibili](https://www.bilibili.com/video/BV1p4411S766/?spm_id_from=333.1007.top_right_bar_window_history.content.click&vd_source=a559f135e6f1797789dd00a1ed110061)) （时长大约1H）
