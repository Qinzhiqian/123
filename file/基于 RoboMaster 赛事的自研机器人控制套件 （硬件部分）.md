# 基于 RoboMaster 赛事的自研机器人控制套件 （硬件部分）\****

## 前言

基于全国大学生机器人竞赛 RoboMaster 系列赛设计的自研机器人控制套件，包括DC-DC开关电源电路设计、主控芯片外围电路设计、陀螺仪模块设计、板间通信设计；通过在Altium Designer软件上绘制原理图与PCB并完成成品，配合软件代码，实现机器人移动，发射弹丸等功能。

### 设计前言

由于机器人的硬件迭代速度比较快，但是迭代的多数情况下都是电路的一小部分在迭代，并不会出现大部分电路都需要都需要更改的情况（外加现在芯片价格飞涨），为了节省成本，我们采用了叠层主控的设计：最小系统+拓展板+电源板

同时，相比于单块集成的PCB而言，多块PCB叠层的设计在机器人有限的平面存放面积上有着较大的优势

## 硬件设计框架

### 机器人总体硬件

机器人总体框架如下

![](https://pic.imgdb.cn/item/64ad0a2f1ddac507cc834e50.jpg)

硬件布局整体由云台底盘两部分组成。上下分别以云台主控板和底盘主控板为核心，主控板使用是STM32F407VET6芯片，双板之间利用can通信通过导电滑环进行数据交流。

底盘和云台主控板都是以三块板子上下连接组而合成，分别为最小系统板、扩展板、电源板。

**设计优势：**

- 扩展板和电源板将电源和信号电路分离，有效防止电源电路干扰信号电路，输出稳定信号
- 云台主控板和底盘主控板对传感器供电和信号通信

### 机器人硬件拓扑

机器人硬件连接的拓扑如下

![](https://pic.imgdb.cn/item/64ad0b091ddac507cc8668ae.jpg)

1. 超级电容：为超级电容充电时要确保每个电容存储电压不超过电容额定电压，能够控制超级电容的充电功率，能够恒压放电。用于机器人在限制功率的情况下，短时间提供较大功率给予机器人使用
2. 主控板：模块化设计
3. 核心板：F4最小系统，引出全兵种通用引脚。当核心板坏了便于更换，同时适用于其他机器人的使用，具有临时替代性，可用于特殊的紧急情况
4. 扩展板：用于根据兵种需要扩展相应功能，容易更换。设计相较简单
5. 陀螺仪：陀螺仪模块与F1集成，内置解算角度，减少主控板运算压力，减低机器人成本

## 单板硬件

控制板单板硬件拓扑如下表格所示

|      单板      |        设计需求         |
| :------------: | :---------------------: |
| **最小系统板** |    STM32F407VET6芯片    |
|   **扩展板**   |  外部接口通信，PWM，IO  |
|   **电源板**   | 转压：24V转5V，5V转3.3V |
| **陀螺仪模块** |        UART通信         |

### 最小系统板

**最小系统板**承载着 STM32F407VET6 芯片作为主控芯片。有充足LED灯来显示各种状态，帮助判断机器人状态。将芯片最小系统从板子分离成单独板子，**通过排针与电源板和扩展板进行供电和通信，迭代也不用进行更换芯片，节省成本。**通过排针和磁珠与其他电路进行隔离，保证了系统的稳定性。同时除了比赛需要用上的引脚之外，还引出了其他空余的引脚，以便于日后的拓展。

原理图如下

![](https://pic.imgdb.cn/item/64ad0fea1ddac507cc9d29fe.jpg)

PCB如下

![](https://pic.imgdb.cn/item/64ad0f9a1ddac507cc9bac8e.jpg)

### 扩展板

**扩展板**负责输出信号，将最小系统上的信号进行扩展，比如CAN信号、串口信号和IO等。接口均采用绿色端子，稳固，方便更换，方便直接用仪器测量信号。上下板间连接和通信均用排针、排母进行，方便更换板子，排查问题。（底盘和云台因为需求不同所以相应电路与PCB会有略微不同，以下以底盘的扩展板为例）

原理图如下

![](https://pic.imgdb.cn/item/64ad14611ddac507ccb1149b.jpg)

PCB如下

![](https://pic.imgdb.cn/item/64ad13191ddac507ccaba1a9.jpg)

### 电源板

**电源板**负责转压和提供稳定供电，将24V降压为5V和5V降压为3.3V，为芯片和传感器供电，有着过压保护和反接保护等电路保护功能，保证稳定供电，同时电源板也可以充当分电板的作用（底盘和云台因为需求不同所以相应电路与PCB会有略微不同，以下以底盘的扩展板为例）

原理图如下

![](https://pic.imgdb.cn/item/64ad159e1ddac507ccb5bfcb.jpg)

PCB如下

![](https://pic.imgdb.cn/item/64ad15b31ddac507ccb60b10.jpg)

### 外接陀螺仪模块

**陀螺仪与主控板**通信和供电接口采用绿色端子，稳固且便于更换、测量信号和电压。PCB小巧，有更高的灵活性，与主控板分离后，主控板就没有水平放置要求，可根据具体情况放置。陀螺仪模块主要由BMI160姿态传感器获取角速度，加速度，通过SPI通信把数据传输到芯片进行处理，然后通过串口与云台主控板进行通信，最后控制板根据数据进行控制

拓扑如下

![](https://pic.imgdb.cn/item/64ad17b31ddac507ccbd811f.jpg)

PCB如下

![](https://pic.imgdb.cn/item/64ad17a81ddac507ccbd57ed.jpg)